digraph kimmdy {
  layout=dot
  label = "KIMMDY modules draft"
  labelloc="t"
  compound=true
  graph [
    compound=true,
    fontname="Miriam Libre",
    rankdir=LR,
  	fontsize=20,
		nodesep=0.4,
		ranksep=0.4,
		#rankdir=LR,
		#bgcolor="transparent",
	]
	
	# kimmdy modules
	node [shape=box, fontname=Roboto]
  	kimmdyHelper [label="Kimmdy helpers"]
  	mdRunner [label="MD runner"]
    reactionManager [label="Reaction manager"]
    reaction1 [label="Reaction Module 1"]
    reaction2 [label="Reaction Module 2"]
    reaction3 [label="Reaction Module 3"]
    samplingRate [label="sampling rate"]
    reactionRate [label="reaction rate"]
    reactionRecipe [label="reaction recipe"]
    relaxRecipe [label="relaxation recipe ?"]
	
	# file-system
	node [shape=ellipse, style=filled, color=lightgrey]
	  tpr [ label=".tpr" ]
	  plumedfile [label=".plumed"]
    state [label=".trr /\nstate of the system"]

  # other software
  node [ shape=box, style="filled", color="lightgrey"]
    grompp [label="gmx grompp"]
    gromacs [label="mdrun"]
    relaxation [label="relaxation"]
    
  subgraph clusterLegend {
    label="Legend"
    modules [shape=box, style=solid, color="black", fontname=Roboto, label="modules"]
    software [shape=box, style="filled", color="lightgrey", label="software"]
    files [shape=ellipse, style="filled", color="lightgrey", label="files"]
  }
	
  subgraph clusterMD {
    label=MD
    mdRunner
    gromacs
    relaxation
    subgraph clusterGMX {
      label="gromacs"
      relaxation
      gromacs
    }
  }
  
  subgraph clusterKIM {
    label="Kinetic Monte Carlo"
    reactionManager
    reaction1 
    reaction2 [style=dotted]
    reaction3 [style=dotted]
    samplingRate
    reactionRate
    reactionRecipe
    relaxRecipe
  }
  
  # Edges
  edge [fontname=Roboto]
  kimmdyHelper -> plumedfile
  grompp -> tpr
  mdRunner -> gromacs
  mdRunner -> relaxation
  gromacs -> reactionManager
  gromacs -> gromacs [label="sampling rate?"] 
  relaxation -> gromacs
  tpr -> mdRunner [lhead=clusterMD]
  plumedfile -> mdRunner [lhead=clusterMD]
  reactionManager -> grompp 
  gromacs -> state 
  reactionManager -> reaction1 [label=""]
  reaction1 -> reactionManager [label=""]
  reactionManager -> reaction2 [style=dotted, arrowhead=d]
  reactionManager -> reaction3 [style=dotted, arrowhead=d]
  state -> reactionManager
  
  edge [arrowhead=none]
  reaction1 -> samplingRate 
  reaction1 -> reactionRate 
  reaction1 -> reactionRecipe
  reaction1 -> relaxRecipe
}
